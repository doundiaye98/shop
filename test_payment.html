<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de paiement - Ma Boutique</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3>üß™ Test de paiement Stripe</h3>
                    </div>
                    <div class="card-body">
                        <p>Ceci est un test de paiement. Utilisez ces cartes de test :</p>
                        <ul>
                            <li><strong>Succ√®s :</strong> 4242 4242 4242 4242</li>
                            <li><strong>√âchec :</strong> 4000 0000 0000 0002</li>
                            <li><strong>3D Secure :</strong> 4000 0025 0000 3155</li>
                        </ul>
                        
                        <form id="payment-form">
                            <div class="mb-3">
                                <label for="card-element">Carte bancaire</label>
                                <div id="card-element" class="form-control"></div>
                                <div id="card-errors" class="text-danger mt-2"></div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                Payer 10.00 ‚Ç¨
                            </button>
                        </form>
                        
                        <div id="payment-result" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialiser Stripe
        const stripe = Stripe("pk_test_votre_cle_publique_de_test");
        const elements = stripe.elements();
        
        // Cr√©er l'√©l√©ment de carte
        const card = elements.create("card");
        card.mount("#card-element");
        
        // G√©rer les erreurs
        card.addEventListener("change", ({error}) => {
            const displayError = document.getElementById("card-errors");
            if (error) {
                displayError.textContent = error.message;
            } else {
                displayError.textContent = "";
            }
        });
        
        // G√©rer la soumission
        const form = document.getElementById("payment-form");
        form.addEventListener("submit", async (event) => {
            event.preventDefault();
            
            const submitButton = form.querySelector("button");
            submitButton.disabled = true;
            submitButton.textContent = "Traitement...";
            
            try {
                // Cr√©er l'intention de paiement
                const response = await fetch("backend/payment_api.php", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        amount: 10.00,
                        paymentMethod: "card"
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error);
                }
                
                // Confirmer le paiement
                const {error} = await stripe.confirmCardPayment(data.client_secret, {
                    payment_method: {
                        card: card,
                    }
                });
                
                if (error) {
                    throw new Error(error.message);
                }
                
                // Succ√®s
                document.getElementById("payment-result").innerHTML = `
                    <div class="alert alert-success">
                        ‚úÖ Paiement r√©ussi ! Commande #${data.order_id}
                    </div>
                `;
                
            } catch (error) {
                document.getElementById("payment-result").innerHTML = `
                    <div class="alert alert-danger">
                        ‚ùå Erreur : ${error.message}
                    </div>
                `;
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = "Payer 10.00 ‚Ç¨";
            }
        });
    </script>
</body>
</html>